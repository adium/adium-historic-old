<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/transitional.dtd">
<html xmlns:xalan="http://xml.apache.org/xslt">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ascii">
<title>SQL Logger Quick Install Instructions</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css">
</head>
<body><table border="0" cellspacing="0" cellpadding="5">
<tr><td colspan="2" bgcolor="#000000" align="right"><h2 class="titlebar">SQL Logger Quick Install Instructions</h2></td></tr>
<tr>
<td width="170" height="20" background="images/transp-change.png" bgcolor="green"></td>
<td height="20" background="images/transp-change.png"></td>
</tr>
<tr>
<td width="170" bgcolor="green" valign="top" align="right">
<h4>SQL Logger<br>
</h4>
<a href="index.html" class="sidebar">Installation Instructions</a><br><a href="http://www.visualdistortion.org/adium/screenshots.jsp" class="offsides">Screenshots</a><br><a href="tsearch.html" class="sidebar">TSearch Installation</a><br><a href="resin.html" class="sidebar">Resin Installation</a><br><a href="technical.html" class="sidebar">Technical
              Details</a><br><a href="performance.html" class="sidebar">Performance/Maintenance</a><br><a href="quick_install.html" class="sidebar">Quick Install
              Notes</a><br><h4>Adium</h4>
<a href="http://www.adiumx.com/" class="offsides">Adium</a><br><a href="http://adium.sourceforge.net" class="offsides">Adium
                2.0</a><br><a href="http://www.funmac.com/forumdisplay.php?forumid=38" class="offsides">Adium
                Forums</a><br><a href="http://www.visualdistortion.org/adium/stats/" class="offsides">CVS Statistics</a><br><a href="http://www.visualdistortion.org/adium/rss.xml" class="offsides">CVS Commit RSS Feed</a><br><h4>PostgreSQL</h4>
<a href="http://www.postgresql.org" class="offsides">PostgreSQL</a><br><a href="http://www.postgresql.org/docs/7.3/interactive/index.html" class="offsides">PSQL Documentation</a><br><a href="http://www.xceltech.net/products/freeware_products.html" class="offsides">PostMan Query</a><br><h4>Visual Distortion</h4>
<a href="http://www.visualdistortion.org/" class="offsides">Visual Distortion Home</a><br><a href="http://www.visualdistortion.org/guestbook.jsp" class="offsides">Guestbook</a><br><a href="http://www.visualdistortion.org/pictures/" class="offsides">Pictures</a><br><a href="http://www.visualdistortion.org/films/" class="offsides">Films</a><br><a href="http://www.visualdistortion.org/music/" class="offsides">Music</a>
</td>
<td>
<p>These instructions are intended for people who want to install
    PostgreSQL from source and the SQL Logger components on Panther.  It covers almost
    everything.</p>
<h3>Installing PostgreSQL</h3>
<p>The first step is to install Fink.  You can get it from <a class="offsite" href="http://fink.sourceforge.net">http://fink.sourceforge.net</a>
</p>
<p>After fink is set up properly, install a couple programs to make
    PostgreSQL work better.</p>
<div class="tutorialcode"><pre>fink install readline
fink install ant</pre></div>
<p>Readline is a library which allows history in the PostgreSQL prompt.  Ant
  lets PostgreSQL compile the Java library.</p>
<p>Download the newest source from <a href="http://www.postgresql.org" class="offsite">http://www.postgresql.org</a>.  If you are on Panther,
  download the newest 7.4 release.  Compiling Postgres follows the
  normal pattern, with a lot of options to configure (several of these are not
  necessary for our purposes, but are included in case they are useful in the
  future):</p>
<div class="tutorialcode">
<pre>./configure --bindir=/usr/local/bin --mandir=/usr/local/share/man/ \
    --enable-recode --with-CXX --enable-odbc --with-java \
    --enable-syslog \  --enable-unicode-conversion --enable-multibyte \
    --with-includes=/sw/include --with-libs=/sw/lib
make
sudo make install</pre>
</div>
<h3>Configuring PostgreSQL</h3>
<p>That's all it takes to compile and install PostgreSQL.  To set it up, you
  need to create a new user for Postgres to run as.  I used NetInfo Manager to
  do this.  After authenticating, select the "www" user and duplicate it.  A
  few things need to be changed after duplicating the user.</p>
<ul>
    <li>Change the short
 username to "postgres", and the long name to "PostgreSQL Server".</li>
    <li>The uid
  and gid values need to be changed.  It doesn't matter what they're changed
  to, as long as it is unique.  If the uid is less than 500, the user will not
  show up on the Login panel. </li>
<li>The shell needs to be changed from null to /bin/bash</li>
</ul>
<p>Now, PostgreSQL can be set up.</p>
<div class="tutorialcode"><pre>jmelloy $] su
root #] mkdir /usr/local/pgsql/data
root #] chown -R postgres /usr/local/pgsql
root #] su postgres
postgres $] /usr/local/bin/initdb -D /usr/local/pgsql/data</pre></div>
<p>This initially sets up PostgreSQL.  For the perl script and JSP stuff to
  work, the file <code>/usr/local/pgsql/data/postgresql.conf</code> needs to
  be edited.  Type <code>pico /usr/local/pgsql/data/postgresql.conf</code> (as
  postgres or root) and change the line that says <code>enable_tcpip</code> to
  true.  If the line starts with #, remove the hash.</p>
<p>Now Postgres is ready to be started.</p>
<div class="tutorialcode"><pre>postgres $] /usr/local/bin/pg_ctl -D /usr/local/pgsql/data \
  -l /usr/local/pgsql/logfile start
postgres $] /usr/local/bin/createdb <i>USERNAME</i>
postgres $] /usr/local/bin/createuser <i>USERNAME</i>
postgres $] su <i>username</i></pre></div>
<h3>Configuring PostgreSQL for use with Adium</h3>
<p>Edit your ~/.bash_profile script using pico.  Add the following lines:</p>
<div class="tutorialcode"><pre>PATH=$PATH:/usr/local/bin
CLASSPATH=/usr/local/pgsql/share/java/postgresql.jar:$CLASSPATH
export PATH CLASSPATH</pre></div>
<p>Now you're ready to use the Adium stuff.</p>
<div class="tutorialcode"><pre>cd ~/adium/Plugins/SQL Logger/help/sql
psql &lt; adium.sql</pre></div>
<h3>Installing Perl (DBI and DBD::Pg)</h3>
<p>To install the perl stuff (if CPAN asks you about manual setup, just say
  no):</p>
<div class="tutorialcode"><pre>su
perl -MCPAN -e 'install DBI'
export POSTGRES_INCLUDE=/usr/local/pgsql/include
export POSTGRES_LIB="/usr/local/pgsql/lib -lssl -lcrypto"
perl -MCPAN -e 'force install DBD::Pg'</pre></div>
<br><div class="important">Since you are force installing DBD::Pg due to errors in
  the make test process, make sure you have the environmental variables set
  correctly.  See <a href="technical.html#parser.pl">Technical Details</a>
  for more info.</div>
<p>Now you can run parser/parser-2.pl.  You may need to edit the paths at the 
  top of the scripts to be "#!/usr/bin/perl".</p>
<h3>Installing tsearch and Resin</h3>
<div class="tutorialcode"><pre>jmelloy $] cd <i>POSTGRES_SOURCE_LOCATION</i>/contrib/tsearch
jmelloy $] make
jmelloy $] sudo make install
jmelloy $] psql &lt; tsearch.sql
jmelloy $] cd ~/adium/Plugins/SQL Logger/help/sql
jmelloy $] psql &lt; tsearch.sql</pre></div>
<p>Now you need to install Resin if you wish to view the logs with the web
  interface.  The web interface is currently more powerful than the built-in
  log viewer. Download Resin from <a href="http://www.caucho.com/" class="offsite">http://www.caucho.com</a>.  It does not matter if you
  download the latest 3.0 version or the latest 2.0, install instructions are
  similar.  Change directories into the Resin folder.</p>
<h4>If you have downloaded Resin 2.1</h4>
<a href="#resin3">Resin 3.0 </a><a href="#comp">End of install</a><div class="tutorialcode"><pre>pico conf/resin.conf</pre></div>
<p>Look for the section that looks like this:</p>
<div class="tutorialcode">
 <pre>&lt;!--
  - Sample database pool configuration
  - The JDBC name is java:comp/env/jdbc/test
 --&gt;
&lt;resource-ref&gt;
  &lt;res-ref-name&gt;jdbc/test&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;init-param driver-name="com.caucho.jdbc.mysql.Driver"/&gt;
  &lt;init-param url="jdbc:mysql_caucho://localhost:3306/test"/&gt;
  &lt;init-param user=""/&gt;
  &lt;init-param password=""/&gt;
  &lt;init-param max-connections="20"/&gt;
  &lt;init-param max-idle-time="30"/&gt;
&lt;/resource-ref&gt;</pre>
    </div>
<p>This needs to be set up to use PostgreSQL.  If you've installed the
    package from Mark Liyanage, you already have the proper JDBC driver.  You
    just need to tell Resin what it needs to use it.  Mine looks like this:</p>
<div class="tutorialcode">
 <pre>&lt;resource-ref&gt;
  &lt;res-ref-name&gt;<b>jdbc/postgresql</b>&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;init-param driver-name="<b>org.postgresql.Driver</b>"/&gt;
  &lt;init-param url="<b>jdbc:postgresql:<i>USERNAME</i></b>"/&gt;
  &lt;init-param user="<b><i>USERNAME</i></b>"/&gt;
  &lt;init-param password=""/&gt;
  &lt;init-param max-connections="20"/&gt;
  &lt;init-param max-idle-time="30"/&gt;
&lt;/resource-ref&gt;</pre>
    </div>
<p>That's all it takes to get Resin to use the database connection.  The
    next step is simply to tell Resin where to look.  Locate the part of
    <i>resin.conf</i> that looks like this:</p>
<div class="tutorialcode">
 <pre>&lt;http-server&gt;
 &lt;!--
  - The root file directory of the server.  Apache users will change
  - this to /usr/local/apache/htdocs and IIS users will change it
  - to d:\inetpub\wwwroot
 --&gt;
 &lt;doc-dir&gt;doc&lt;/doc-dir&gt;</pre>
 </div>
<p>Simply change the part in between the &lt;doc-dir&gt; tags to where you
   want to put the JSP pages.  (/Users/<i>USERNAME</i>/Sites/).</p>
<a name="resin3"></a><h4>If you installed Resin 3.0: </h4>
<a href="#complete">Skip to the end</a><p>The configuration file needs to be edited.  Resin needs to be told how to
   connect to PostgreSQL and where you have put the JSP files.</p>
<div class="tutorialcode"><pre>pico conf/resin.conf</pre></div>
<p>To configure the database, find the section that looks like this:</p>
<div class="tutorialcode">
   <pre>&lt;!--
   - Sample database pool configuration
   -
   - The JDBC name is java:comp/env/jdbc/test
   -
    &lt;database&gt;
      &lt;jndi-name&gt;jdbc/mysql&lt;/jndi-name&gt;
      &lt;driver type="org.gjt.mm.mysql.Driver"&gt;
        &lt;url&gt;jdbc:mysql://localhost:3306/test&lt;/url&gt;
        &lt;user&gt;&lt;/user&gt;
        &lt;password&gt;&lt;/password&gt;
      &lt;/driver&gt;
      &lt;max-connections&gt;20&lt;/max-connections&gt;
      &lt;max-idle-time&gt;30s&lt;/max-idle-time&gt;
    &lt;/database&gt;
    --&gt;</pre>
</div>
<p>And change it to look like this:</p>
<div class="tutorialcode">
   <pre>&lt;!--
   - Sample database pool configuration
   -
   - The JDBC name is java:comp/env/jdbc/test
   -
  <b> --&gt;</b>
    &lt;database&gt;
      &lt;jndi-name&gt;jdbc/postgresql&lt;/jndi-name&gt;
      &lt;driver type="<b>org.postgresql.Driver</b>"&gt;
        &lt;url&gt;<b>jdbc:postgresql:<i>USERNAME</i></b>&lt;/url&gt;
        &lt;user&gt;<b><i>USERNAME</i></b>&lt;/user&gt;
        &lt;password&gt;&lt;/password&gt;
      &lt;/driver&gt;
      &lt;max-connections&gt;20&lt;/max-connections&gt;
      &lt;max-idle-time&gt;30s&lt;/max-idle-time&gt;
    &lt;/database&gt;</pre>
</div>
<br><div class="important">Make sure you move the "--&gt;" to above the
  &lt;database&gt;.  Otherwise you will comment out the entire file.</div>
<p>Next, find the part referring to the document directory.  The document
  directory tells where to look for files.  It needs to be changed to wherever
  you wish to put the JSPs.</p>
<div class="tutorialcode">
  <pre>&lt;!-- configures the default host, matching any host name --&gt;
&lt;host id=''&gt;
  &lt;document-directory&gt;<b>doc</b>&lt;/document-directory&gt;</pre>
</div>
<a name="#complete"></a><p>That's all it takes to set Resin up.</p>
<div class="tutorialcode">
    <pre>bin/httpd.sh</pre>
  </div>
<p>To test it out, fire up a web browser and go to <a href="http://localhost:8080/">http://localhost:8080/</a>.  You should see a
  directory listing of your files, or if you've already moved the adium jsps
  into the directory, the front page.  If you have an index.html file in
  there, that may be served.</p>
<h3>Installing the Adium Plugin</h3>
<p>All that is left is installing the Adium plugin itself.  You can either
  download the Adium source and compile it yourself, or download the plugin
  from here.  I would recommend compiling from source.  It's not difficult.
  Download the newest Adium source from <a href="http://adium.sourceforge.net" class="offsite">http://adium.sourceforge.net</a>.  Open it up in Project
  Builder or XCode, switch the active target to "SQL Logger", and hit compile.
  Then go into the build directory, select "SQL Logger.AdiumPlugin" and drag
  it to the <code>~/Library/Application Support/Adium 2.0/Plugins</code>.
  That's it.</p>
<hr>
<div align="right"><a href="mailto:jmelloy@visualdistortion.org">jmelloy@visualdistortion.org</a></div>
</td>
</tr>
</table></body>
</html>
