<?xml version="1.0"?>
<?xml-stylesheet href="transform.xsl" type="text/xsl"?>
<page>
  <title>SQL Logger Quick Install Instructions</title>
  <body>
  <p>These instructions are intended for people who want to install
    PostgreSQL from source and the SQL Logger components on Panther.  It covers almost
    everything.</p>
  <h3>Installing PostgreSQL</h3>
  <p>The first step is to install Fink.  You can get it from <a
 class="offsite"
 href="http://fink.sourceforge.net">http://fink.sourceforge.net</a></p>
  <p>After fink is set up properly, install a couple programs to make
    PostgreSQL work better.  You can also use DarwinPorts (<a class="offsite"
      href="http://darwinports.opendarwin.org/ports/">http://darwinports.opendarwin.org/ports/</a> for this purpose, if
  you have the desire.</p>
  <div class="tutorialcode"><pre>fink install readline
fink install ant</pre></div>
  <p>If you are using darwinports:</p>
  <div class="tutorialcode"><pre>sudo port install readline
sudo port install apache-ant</pre></div>
<p>Readline is a library which allows history in the PostgreSQL prompt.  Ant
  lets PostgreSQL compile the Java library.</p>
<p>Download the newest source from <a href="http://www.postgresql.org"
    class="offsite">http://www.postgresql.org</a>.  If you are on Panther,
  download the newest 7.4 release.  Compiling Postgres follows the
  normal pattern, with a lot of options to configure (several of these are not
  necessary for our purposes, but are included in case they are useful in the
  future):</p>
<div class="tutorialcode"><pre>./configure --bindir=/usr/local/bin --mandir=/usr/local/share/man/ \
    --enable-recode --with-CXX --enable-odbc --with-java \
    --enable-syslog --enable-unicode-conversion --enable-multibyte \
    --with-includes=/sw/include --with-libs=/sw/lib
make
sudo make install</pre>
</div>
<p>If you are using darwin ports, you need to change the --with-includes and
  --with-libs flag to <code>--with-includes=/opt/local/include</code>
  and <code>--with-libs=/opt/local/lib</code> .</p>
<h3>Configuring PostgreSQL</h3>
<p>That's all it takes to compile and install PostgreSQL.  To set it up, you
  need to create a new user for Postgres to run as.  I used NetInfo Manager to
  do this.  After authenticating, select the "www" user and duplicate it.  A
  few things need to be changed after duplicating the user.</p>
  <ul>
    <li>Change the short
 username to "postgres", and the long name to "PostgreSQL Server".</li>
    <li>The uid
  and gid values need to be changed.  It doesn't matter what they're changed
  to, as long as it is unique.  If the uid is less than 500, the user will not
  show up on the Login panel. </li>
<li>The shell needs to be changed from null to /bin/bash</li>
</ul>
<p>Now, PostgreSQL can be set up.</p>
<div class="tutorialcode"><pre>jmelloy $] su
root #] mkdir /usr/local/pgsql/data
root #] chown -R postgres /usr/local/pgsql
root #] su postgres
postgres $] /usr/local/bin/initdb -D /usr/local/pgsql/data</pre></div>
<p>This initially sets up PostgreSQL.  For the Perl script and JSP stuff to
  work, the file <code>/usr/local/pgsql/data/postgresql.conf</code> needs to
  be edited.  Type <code>pico /usr/local/pgsql/data/postgresql.conf</code> (as
  postgres or root) and change the line that says <code>tcpip_socket</code> to
  true.  If the line starts with #, remove the hash.</p>
<p>Now Postgres is ready to be started.  URERNAME refers to your unix
  username, which is also known as your short name.  The prompt should say
  your unix username.</p>
<div class="tutorialcode"><pre>postgres $] /usr/local/bin/pg_ctl -D /usr/local/pgsql/data \
    -l /usr/local/pgsql/logfile start
postgres $] createlang plpgsql template1
postgres $] /usr/local/bin/createdb <i>USERNAME</i>
postgres $] /usr/local/bin/createuser <i>USERNAME</i>
postgres $] su <i>username</i></pre></div>
<h3>Configuring PostgreSQL for use with Adium</h3>
<p>Edit your ~/.bash_profile script using pico.  Add the following lines:</p>
<div class="tutorialcode"><pre>PATH=$PATH:/usr/local/bin
CLASSPATH=/usr/local/pgsql/share/java/postgresql.jar:$CLASSPATH
export PATH CLASSPATH</pre></div>

<p>Now you're ready to use the Adium stuff.</p>
<div class="tutorialcode"><pre>cd ~/adium/Plugins/SQL Logger/help/sql
psql &lt; create.sql
createlang plpgsql
psql &lt; functions.sql</pre></div>

<p>At this point, it is helpful to edit the search path of the database.</p>
<div class="tutorialcode"><pre>jmelloy $] psql
Welcome to psql 7.4, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help on internal slash commands
       \g or terminate with semicolon to execute query
       \q to quit

jmelloy=# alter user <i>username</i> set search_path=adium,public;</pre></div>

<p>At this point, you're ready to import your logs into the database.  Simply
  use the parser-2.pl script, and it will import all of your adium 2.x
  logfiles.  If you wish to use parser.pl (for 1.x logs) you will need to
  install DBI and DBD::Pg.</p>
<div class="tutorialcode"><pre>jmelloy $] ./parser-2.pl</pre></div>
<h3>Installing tsearch and Resin</h3>
<div class="tutorialcode"><pre>jmelloy $] cd <i>POSTGRES_SOURCE_LOCATION</i>/contrib/tsearch2
jmelloy $] make
jmelloy $] sudo make install
jmelloy $] psql &lt; tsearch2.sql
jmelloy $] cd ~/adium/Plugins/SQL Logger/help/sql
jmelloy $] psql &lt; tsearch2.sql</pre></div>

<p>Now you need to install Resin if you wish to view the logs with the web
  interface.  The web interface is currently more powerful than the built-in
  log viewer. Download Resin from <a href="http://www.caucho.com/"
    class="offsite">http://www.caucho.com</a>.  It does not matter if you
  download the latest 3.0 version or the latest 2.0, install instructions are
  similar.  Change directories into the Resin folder.</p>

<h4>If you have downloaded Resin 2.1</h4> <a href="#resin3">Resin 3.0
  Instructions</a><br /><a
  href="#comp">End of install</a>
<div class="tutorialcode"><pre>pico conf/resin.conf</pre></div>
    <p>Look for the section that looks like this:</p>
    <div class="tutorialcode">
 <pre>&lt;!--
  - Sample database pool configuration
  - The JDBC name is java:comp/env/jdbc/test
 --&gt;
&lt;resource-ref&gt;
  &lt;res-ref-name&gt;jdbc/test&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;init-param driver-name=&quot;com.caucho.jdbc.mysql.Driver&quot;/&gt;
  &lt;init-param url=&quot;jdbc:mysql_caucho://localhost:3306/test&quot;/&gt;
  &lt;init-param user=&quot;&quot;/&gt;
  &lt;init-param password=&quot;&quot;/&gt;
  &lt;init-param max-connections=&quot;20&quot;/&gt;
  &lt;init-param max-idle-time=&quot;30&quot;/&gt;
&lt;/resource-ref&gt;</pre>
    </div>
    <p>This needs to be set up to use PostgreSQL.  If you've installed the
    package from Mark Liyanage, you already have the proper JDBC driver.  You
    just need to tell Resin what it needs to use it.  Mine looks like this:</p>

    <div class="tutorialcode">
 <pre>&lt;resource-ref&gt;
  &lt;res-ref-name&gt;<b>jdbc/postgresql</b>&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;init-param driver-name=&quot;<b>org.postgresql.Driver</b>&quot;/&gt;
  &lt;init-param url=&quot;<b>jdbc:postgresql:<i>USERNAME</i></b>&quot;/&gt;
  &lt;init-param user=&quot;<b><i>USERNAME</i></b>&quot;/&gt;
  &lt;init-param password=&quot;&quot;/&gt;
  &lt;init-param max-connections=&quot;20&quot;/&gt;
  &lt;init-param max-idle-time=&quot;30&quot;/&gt;
&lt;/resource-ref&gt;</pre>
    </div>
    <p>That's all it takes to get Resin to use the database connection.  The
    next step is simply to tell Resin where to look.  Locate the part of
    <i>resin.conf</i> that looks like this:</p>
    <div class="tutorialcode">
 <pre>&lt;http-server&gt;
 &lt;!--
  - The root file directory of the server.  Apache users will change
  - this to /usr/local/apache/htdocs and IIS users will change it
  - to d:\inetpub\wwwroot
 --&gt;
 &lt;doc-dir&gt;doc&lt;/doc-dir&gt;</pre>
 </div>
 <p>Simply change the part in between the &lt;doc-dir&gt; tags to where you
   want to put the JSP pages.  (/Users/<i>USERNAME</i>/Sites/).</p>
 <a name="resin3" />

 <h4>If you installed Resin 3.0: </h4> <a href="#complete">Skip to the end</a>

 <p>The configuration file needs to be edited.  Resin needs to be told how to
   connect to PostgreSQL and where you have put the JSP files.</p>
 <div class="tutorialcode"><pre>pico conf/resin.conf</pre></div>
 <p>To configure the database, find the section that looks like this:</p>
 <div class="tutorialcode">
   <pre>&lt;!--
   - Sample database pool configuration
   -
   - The JDBC name is java:comp/env/jdbc/test
   -
    &lt;database&gt;
      &lt;jndi-name&gt;jdbc/mysql&lt;/jndi-name&gt;
      &lt;driver type="org.gjt.mm.mysql.Driver"&gt;
        &lt;url&gt;jdbc:mysql://localhost:3306/test&lt;/url&gt;
        &lt;user&gt;&lt;/user&gt;
        &lt;password&gt;&lt;/password&gt;
      &lt;/driver&gt;
      &lt;max-connections&gt;20&lt;/max-connections&gt;
      &lt;max-idle-time&gt;30s&lt;/max-idle-time&gt;
    &lt;/database&gt;
    --&gt;</pre></div>
<p>And change it to look like this:</p>
 <div class="tutorialcode">
   <pre>&lt;!--
   - Sample database pool configuration
   -
   - The JDBC name is java:comp/env/jdbc/test
   -
  <b> --&gt;</b>
    &lt;database&gt;
    &lt;jndi-name&gt;<b>jdbc/postgresql</b>&lt;/jndi-name&gt;
      &lt;driver type="<b>org.postgresql.Driver</b>"&gt;
        &lt;url&gt;<b>jdbc:postgresql:<i>USERNAME</i></b>&lt;/url&gt;
        &lt;user&gt;<b><i>USERNAME</i></b>&lt;/user&gt;
        &lt;password&gt;&lt;/password&gt;
      &lt;/driver&gt;
      &lt;max-connections&gt;20&lt;/max-connections&gt;
      &lt;max-idle-time&gt;30s&lt;/max-idle-time&gt;
    &lt;/database&gt;</pre></div><br />
<div class="important">Make sure you move the "--&gt;" to above the
  &lt;database&gt;.  Otherwise you will comment out the entire file.</div>
<p>Next, find the part referring to the document directory.  The document
  directory tells where to look for files.  It needs to be changed to wherever
  you wish to put the JSPs.</p>
<div class="tutorialcode">
  <pre>&lt;!-- configures the default host, matching any host name --&gt;
&lt;host id=''&gt;
  &lt;document-directory&gt;<b>doc</b>&lt;/document-directory&gt;</pre>
</div>
 <a name="#complete" />
   <p>That's all it takes to set Resin up.</p>
  <div class="tutorialcode">
    <pre>bin/httpd.sh</pre>
  </div>
  <p>To test it out, fire up a web browser and go to <a
 href="http://localhost:8080/">http://localhost:8080/</a>.  You should see a
  directory listing of your files, or if you've already moved the adium jsps
  into the directory, the front page.  If you have an index.html file in
  there, that may be served.</p>
<h3>Installing the Adium Plugin</h3>
<p>All that is left is installing the Adium plugin itself.  You can either
  download the Adium source and compile it yourself, or download the plugin
  from here.  I would recommend compiling from source.  It's not difficult.
  Download the newest Adium source from <a href="http://im.sourceforge.net"
    class="offsite">http://im.sourceforge.net</a>.  Open it up in Project
  Builder or XCode, switch the active target to "SQL Logger", and hit compile.
  Then go into the build directory, select "SQL Logger.AdiumPlugin" and drag
  it to the <code>~/Library/Application Support/Adium 2.0/Plugins</code>.
  That's it.</p>
</body>
</page>

