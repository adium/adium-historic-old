<?xml version="1.0"?>
<?xml-stylesheet href="transform.xsl" type="text/xsl"?>
<page>
<title>Resin/JSP Installation Instructions</title>
  <body>
    <p>To view the database logs with a web interface, you need to install a
    JSP servlet engine.  Several are available, but I prefer one called
    "Resin".  You can get it at <a
      href="http://www.caucho.com" class="offsite">http://www.caucho.com</a>.</p>
    <p>Download the newest 2.0 release (2.1.9) for Unix.  It's not very
    difficult to install at all.  Most browsers will automatically decompress
    the file, but if you need to, open up a terminal window
    and type </p>
    <div class="tutorialcode">
      <pre>gunzip resin-2.1.x.tar.gz
tar -xvf resin-2.1.x.tar</pre>
    </div>
    <p>At this point, you should have a folder called "resin-2.1.x".  Open up
    a terminal and cd into the folder.  To simply run Resin, nothing really
    needs to be done.  The default settings are pretty good,
    but a few things need to be changed.  While in the Resin folder, type</p>
    <div class="tutorialcode"><pre>pico conf/resin.conf</pre></div>
    <p>Look for the section that looks like this:</p>
    <div class="tutorialcode">
      <pre>&lt;!--
  - Sample database pool configuration
  - The JDBC name is java:comp/env/jdbc/test
 --&gt;
&lt;resource-ref&gt;
  &lt;res-ref-name&gt;jdbc/test&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;init-param driver-name=&quot;com.caucho.jdbc.mysql.Driver&quot;/&gt;
  &lt;init-param url=&quot;jdbc:mysql_caucho://localhost:3306/test&quot;/&gt;
  &lt;init-param user=&quot;&quot;/&gt;
  &lt;init-param password=&quot;&quot;/&gt;
  &lt;init-param max-connections=&quot;20&quot;/&gt;
  &lt;init-param max-idle-time=&quot;30&quot;/&gt;
&lt;/resource-ref&gt;</pre>
    </div>
    <p>This needs to be set up to use PostgreSQL.  If you've installed the
    package from Mark Liyanage, you already have the proper JDBC driver.  You
    just need to tell Resin what it needs to use it.  Mine looks like this:</p>

    <div class="tutorialcode">
      <pre>&lt;resource-ref&gt;
  &lt;res-ref-name&gt;<b>jdbc/postgresql</b>&lt;/res-ref-name&gt;
  &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
  &lt;init-param driver-name=&quot;<b>org.postgresql.Driver</b>&quot;/&gt;
  &lt;init-param url=&quot;<b>jdbc:postgresql:<i>USERNAME</i></b>&quot;/&gt;
  &lt;init-param user=&quot;<b><i>USERNAME</i></b>&quot;/&gt;
  &lt;init-param password=&quot;&quot;/&gt;
  &lt;init-param max-connections=&quot;20&quot;/&gt;
  &lt;init-param max-idle-time=&quot;30&quot;/&gt;
&lt;/resource-ref&gt;</pre>
    </div>
    <p>That's all it takes to get Resin to use the database connection.  The
    next step is simply to tell Resin where to look.  Locate the part of
    <i>resin.conf</i> that looks like this:</p>
    <div class="tutorialcode">
      <pre>&lt;http-server&gt;
 &lt;!--
  - The root file directory of the server.  Apache users will change
  - this to /usr/local/apache/htdocs and IIS users will change it
  - to d:\inetpub\wwwroot
 --&gt;
 &lt;doc-dir&gt;doc&lt;/doc-dir&gt;</pre>
 </div>
 <p>Simply change the part in between the &lt;doc-dir&gt; tags to where you
   want to put the JSP pages.  (/Users/<i>USERNAME</i>/Sites/).</p>
 <p>That's all it takes to set Resin up.</p> 
 <p>If you have the Mark Liyanage PostgreSQL package installed, the JDBC
 driver is in <code>/usr/local/pgsql/share/java/</code> Resin needs to be told where this driver is.  If you do not have the Mark Liyanage package installed, replace the path with your existing JDBC path.  To start Resin type the command</p>
  <div class="tutorialcode">
    <pre>bin/httpd.sh -classpath /usr/local/pgsql/share/java/postgresql.jar start</pre>
  </div>
  <p>To test it out, fire up a web browser and go to <a
      href="http://localhost:8080/">http://localhost:8080/</a>.  You should see a
  directory listing of your files, or if you've already moved the adium jsps
  into the directory, the front page.  If you have an index.html file in
  there, that may be served.</p>
<p>Note, to work, this require PostgreSQL to be accepting TCP/IP connections.
  Either do this by passing the "-i" flag to pg_ctl as it is started up, or by
  editing /usr/local/pgsql/data/postgresql.conf and settting the lines that
  looks like this:</p>
<div class="tutorialcode">
  <pre>#tcpip_socket = false</pre>
</div>
<p>to this:</p>
<div class="tutorialcode">
  <pre>tcpip_socket = true</pre>
</div>
    <p>After doing this, you need to either send PostgreSQL a SIGHUP, or use
      <code>pg_ctl reload</code></p>
  <p>Starting Resin by hand works, but you need to remember to start Resin every time you
  restart your computer.  It would be better if it started at startup.  The
  package I have starting it can be downloaded from <a
    href="http://www.visualdistortion.org/adium/resin.tar.gz" class="offsite">
    http://www.visualdistortion.org/adium/resin.tar.gz</a>.  Simply change the
  information in the "Resin" script to your path and startup information (I
  have the postgresql.jar added to my CLASSPATH environmental variable, so I
  don't need to explicitly call it) and put the "Resin" folder in 
  <code>/Library/StartupItems</code>.</p>
</body>
</page>
