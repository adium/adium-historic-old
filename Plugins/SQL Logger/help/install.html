<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/transitional.dtd">
<html>
<head>
<meta content="text/html; charset=ascii" http-equiv="Content-Type">
<title>SQL Logger Installation Instructions (OS X)</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css">
</head>
<body><div id="container">
<div id="banner"><h2 class="titlebar">SQL Logger Installation Instructions (OS X)</h2></div>
<div id="sidebar-a">
<h4>SQL Logger<br>
</h4>
<a href="index.html" class="sidebar">Home</a><br><a href="http://www.visualdistortion.org/sqllogger/screenshots.jsp" class="offsides">Screenshots</a><br><a href="install.html" class="sidebar">Installation</a><br><a href="technical.html" class="sidebar">Technical
              Details</a><br><a href="performance.html" class="sidebar">Maintenance/Performance</a><br><a href="changes.txt" class="offsides">Changelog</a><br><a href="http://www.visualdistortion.org/sqllogger/sqllogger.tar.gz" class="offsides"><b>JSP/HTML package</b></a><br><h4>Adium</h4>
<a href="http://www.adiumx.com/" class="offsides">Adium</a><br><a href="http://forums.adiumx.com" class="offsides">Adium
                Forums</a><br><a href="http://planet.adiumx.com" class="offsides">Planet Adium</a><br><a href="http://cia.navi.cx/stats/project/adium/" class="offsides">CVS Changes</a><br><a href="http://www.visualdistortion.org/sqllogger/adium-sql.tar.gz" class="offsides">Adium Plugin</a><br><h4>Fire</h4>
<a href="http://fire.sourceforge.net" class="offsides">Fire</a><br><h4>PostgreSQL</h4>
<a href="http://www.postgresql.org" class="offsides">PostgreSQL</a><br><a href="http://www.postgresql.org/docs/7.4/interactive/index.html" class="offsides">PgSQL Documentation</a><br><a href="http://www.xceltech.net/products/freeware_products.html" class="offsides">PostMan Query</a><br><h4>Visual Distortion</h4>
<a href="http://www.visualdistortion.org/" class="offsides">Visual Distortion Home</a>
</div>
<div id="content">
<p>These instructions are intended for people who want to install
    PostgreSQL from source and the SQL Logger components on Panther.  It covers almost
    everything.</p>
<h3>Installing PostgreSQL</h3>
<p>The first step is to install Fink.  You can get it from <a class="offsite" href="http://fink.sourceforge.net">http://fink.sourceforge.net</a>
</p>
<p>After fink is set up properly, install a couple programs to make
    PostgreSQL work better.  You can also use DarwinPorts (<a class="offsite" href="http://darwinports.opendarwin.org/ports/">http://darwinports.opendarwin.org/ports/</a> for this purpose, if
  you have the desire.</p>
<div class="tutorialcode"><pre>fink install readline
fink install ant</pre></div>
<p>If you are using darwinports:</p>
<div class="tutorialcode"><pre>sudo port install readline
sudo port install apache-ant</pre></div>
<p>Readline is a library which allows history in the PostgreSQL prompt.  Ant
  lets PostgreSQL compile the Java library.</p>
<p>Download the newest source from <a href="http://www.postgresql.org" class="offsite">http://www.postgresql.org</a>.  If you are on Panther,
  download the newest 7.4 release.  Compiling Postgres follows the
  normal pattern, with a lot of options to configure (several of these are not
  necessary for our purposes, but are included in case they are useful in the
  future):</p>
<div class="tutorialcode">
<pre>./configure --bindir=/usr/local/bin --mandir=/usr/local/share/man/ \
    --enable-recode --with-CXX --enable-odbc --with-java \
    --enable-syslog --enable-unicode-conversion --enable-multibyte \
    --with-includes=/sw/include --with-libs=/sw/lib
make
sudo make install</pre>
</div>
<p>If you are using darwin ports, you need to change the --with-includes and
  --with-libs flag to <code>--with-includes=/opt/local/include</code>
  and <code>--with-libs=/opt/local/lib</code> .</p>
<h3>Configuring PostgreSQL</h3>
<p>That's all it takes to compile and install PostgreSQL.  To set it up, you
  need to create a new user for Postgres to run as.  I used NetInfo Manager to
  do this.  After authenticating, select the &quot;www&quot; user and duplicate it.  A
  few things need to be changed after duplicating the user.</p>
<ul>
    <li>Change the short
 username to &quot;postgres&quot;, and the long name to &quot;PostgreSQL Server&quot;.</li>
    <li>The uid
  and gid values need to be changed.  It doesn't matter what they're changed
  to, as long as it is unique.  If the uid is less than 500, the user will not
  show up on the Login panel. </li>
<li>The shell needs to be changed from null to /bin/bash</li>
</ul>
<p>Now, PostgreSQL can be set up.</p>
<div class="tutorialcode"><pre>jmelloy $] su
root #] mkdir /usr/local/pgsql/data
root #] chown -R postgres /usr/local/pgsql
root #] su postgres
postgres $] /usr/local/bin/initdb -D /usr/local/pgsql/data</pre></div>
<p>This initially sets up PostgreSQL.  For the Perl script and JSP stuff to
  work, the file <code>/usr/local/pgsql/data/postgresql.conf</code> needs to
  be edited.  Type <code>pico /usr/local/pgsql/data/postgresql.conf</code> (as
  postgres or root) and change the line that says <code>tcpip_socket</code> to
  true.  If the line starts with #, remove the hash.</p>
<p>Now Postgres is ready to be started.  USERNAME refers to your unix
  username, which is also known as your short name.  The prompt should say
  your unix username.</p>
<div class="tutorialcode"><pre>postgres $] /usr/local/bin/pg_ctl -D /usr/local/pgsql/data \
    -l /usr/local/pgsql/logfile start
postgres $] /usr/local/bin/createdb <i>USERNAME</i>
postgres $] /usr/local/bin/createuser <i>USERNAME</i>
postgres $] su <i>username</i></pre></div>
<h3>Configuring PostgreSQL</h3>
<p>Edit your ~/.bash_profile script using pico.  Add the following lines:</p>
<div class="tutorialcode"><pre>PATH=$PATH:/usr/local/bin
CLASSPATH=/usr/local/pgsql/share/java/postgresql.jar:$CLASSPATH
export PATH CLASSPATH</pre></div>
<p>Now you're ready to use the SQL Logger  stuff.</p>
<div class="tutorialcode"><pre>cd ~/sqllogger/sql
psql &lt; create.sql</pre></div>
<p>At this point, it is helpful to edit the search path of the database.</p>
<div class="tutorialcode"><pre>jmelloy $] psql
Welcome to psql 7.4, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help on internal slash commands
       \g or terminate with semicolon to execute query
       \q to quit

jmelloy=# alter user <i>username</i> set search_path=im,public;</pre></div>
<p>At this point, you're ready to import your logs into the database.  Simply
  use the parser.pl script, and it will import all of your adium 2.x
  logfiles.</p>
<div class="tutorialcode"><pre>jmelloy $] ./parser.pl</pre></div>
<h3>Installing tsearch for fast searching</h3>
<div class="tutorialcode"><pre>jmelloy $] cd <i>POSTGRES_SOURCE_LOCATION</i>/contrib/tsearch2
jmelloy $] make
jmelloy $] sudo make install
jmelloy $] psql &lt; tsearch2.sql
jmelloy $] cd ~/sqllogger/sql
jmelloy $] psql &lt; tsearch2.sql</pre></div>
<p>Now you need to install Resin if you wish to view the logs with the web
  interface.  The web interface is currently more powerful than the built-in
  log viewer. Download Resin from <a href="http://www.caucho.com/" class="offsite">http://www.caucho.com</a>.  Get the latest 3.0 release.  Change directories into the Resin folder.</p>
<h3>Resin 3.0.x: </h3>
<p>The configuration file needs to be edited.  Resin needs to be told how to
   connect to PostgreSQL and where you have put the JSP files.</p>
<div class="tutorialcode"><pre>pico conf/resin.conf</pre></div>
<p>To configure the database, find the section that looks like this:</p>
<div class="tutorialcode">
   <pre>&lt;!--
   - Sample database pool configuration
   -
   - The JDBC name is java:comp/env/jdbc/test
   -
    &lt;database&gt;
      &lt;jndi-name&gt;jdbc/mysql&lt;/jndi-name&gt;
      &lt;driver type=&quot;org.gjt.mm.mysql.Driver&quot;&gt;
        &lt;url&gt;jdbc:mysql://localhost:3306/test&lt;/url&gt;
        &lt;user&gt;&lt;/user&gt;
        &lt;password&gt;&lt;/password&gt;
      &lt;/driver&gt;
      &lt;max-connections&gt;20&lt;/max-connections&gt;
      &lt;max-idle-time&gt;30s&lt;/max-idle-time&gt;
    &lt;/database&gt;
    --&gt;</pre>
</div>
<p>And change it to look like this:</p>
<div class="tutorialcode">
   <pre>&lt;!--
   - Sample database pool configuration
   -
   - The JDBC name is java:comp/env/jdbc/test
   -
  <b> --&gt;</b>
    &lt;database&gt;
    &lt;jndi-name&gt;<b>jdbc/postgresql</b>&lt;/jndi-name&gt;
      &lt;driver type=&quot;<b>org.postgresql.Driver</b>&quot;&gt;
        &lt;url&gt;<b>jdbc:postgresql:<i>USERNAME</i></b>&lt;/url&gt;
        &lt;user&gt;<b><i>USERNAME</i></b>&lt;/user&gt;
        &lt;password&gt;&lt;/password&gt;
      &lt;/driver&gt;
      &lt;max-connections&gt;20&lt;/max-connections&gt;
      &lt;max-idle-time&gt;30s&lt;/max-idle-time&gt;
    &lt;/database&gt;</pre>
</div>
<br><div class="important">Make sure you move the &quot;--&gt;&quot; to above the
  &lt;database&gt;.  Otherwise you will comment out the entire file.</div>
<p>Next, find the part referring to the document directory.  The document
  directory tells where to look for files.  It needs to be changed to wherever
  you wish to put the JSPs.</p>
<div class="tutorialcode">
  <pre>&lt;!-- configures the default host, matching any host name --&gt;
&lt;host id=''&gt;
  &lt;document-directory&gt;<b>doc</b>&lt;/document-directory&gt;</pre>
</div>
<p>That's all it takes to set Resin up.</p>
<div class="tutorialcode">
    <pre>bin/httpd.sh</pre>
  </div>
<p>To test it out, fire up a web browser and go to <a href="http://localhost:8080/">http://localhost:8080/</a>.  You should see a
  directory listing of your files, or if you've already moved the JSP files
  into the directory, the front page.  If you have an index.html file in
  there, that may be served.</p>
<h3>Installing the Plugin</h3>
<p>All that is left is installing the plugin itself.</p>
</div>
<div id="footer">SQL Logger Installation Instructions (OS X)<br><a href="mailto:jmelloy@visualdistortion.org">jmelloy@visualdistortion.org</a>
</div>
</div></body>
</html>
